<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片选择与预览器</title>
    <!-- 引入Tailwind CSS -->
    <script src="../js/tailwind.min.js"></script>
    <!-- 引入Font Awesome -->
    <link rel="stylesheet" href="../css/font-awesome.min.css">

    
    <!-- 配置Tailwind自定义颜色和字体 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        neutral: '#64748B',
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .transition-transform-opacity {
                transition-property: transform, opacity;
            }
            .preview-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 1rem;
            }
        }
    </style>
</head>
<body class="font-inter bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- 页面标题 -->
        <header class="mb-8 text-center">
            <h1 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-gray-800 mb-2">图片选择与预览器</h1>
            <p class="text-neutral text-lg">选择多张图片，在右侧实时预览</p>
        </header>
        
        <!-- 主内容区 -->
        <main class="bg-white rounded-xl shadow-lg overflow-hidden">
            <div class="flex flex-col lg:flex-row">
                <!-- 左侧：文件选择区 -->
                <div class="w-full lg:w-1/3 p-6 border-b lg:border-b-0 lg:border-r border-gray-100 bg-gray-50">
                    <div class="mb-6">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                            <i class="fa fa-upload text-primary mr-2"></i>选择图片
                        </h2>
                        
                        <!-- 文件选择按钮 -->
                        <label for="file-input" class="block w-full">
                            <div class="relative cursor-pointer bg-primary hover:bg-primary/90 text-white font-medium py-4 px-6 rounded-lg transition-all duration-300 shadow-md hover:shadow-lg text-center">
                                <i class="fa fa-picture-o mr-2"></i>点击选择图片
                                <p class="text-sm mt-1 text-blue-100">支持多选，格式：JPG、PNG、GIF</p>
                                <input id="file-input" type="file" accept="image/*" multiple class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" />
                            </div>
                        </label>
                        
                        <!-- 已选文件数量 -->
                        <div id="file-count" class="mt-4 text-center text-neutral hidden">
                            <p><i class="fa fa-files-o mr-1"></i>已选择 <span id="count-number">0</span> 张图片</p>
                        </div>
                    </div>
                    
                    <!-- 使用说明 -->
                    <div class="bg-blue-50 border border-blue-100 rounded-lg p-4">
                        <h3 class="font-medium text-primary mb-2 flex items-center">
                            <i class="fa fa-info-circle mr-2"></i>使用说明
                        </h3>
                        <ul class="text-sm text-gray-700 space-y-2">
                            <li class="flex items-start">
                                <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                                <span>点击按钮或直接拖放图片到区域内</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                                <span>按住Ctrl键可选择多张图片</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                                <span>点击预览图可移除该图片</span>
                            </li>
                        </ul>
                    </div>
                </div>
                
                <!-- 右侧：预览区 -->
                <div class="w-full lg:w-2/3 p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fa fa-eye text-primary mr-2"></i>图片预览
                    </h2>
                    
                    <!-- 预览区初始状态 -->
                    <div id="preview-placeholder" class="flex flex-col items-center justify-center h-64 border-2 border-dashed border-gray-300 rounded-lg text-gray-400">
                        <i class="fa fa-image text-5xl mb-3"></i>
                        <p>所选图片将在这里显示</p>
                    </div>
                    
                    <!-- 预览图片网格 -->
                    <div id="preview-container" class="preview-grid hidden"></div>
                </div>
            </div>
        </main>
        
        <!-- 页脚 -->
        <footer class="mt-8 text-center text-neutral text-sm">
            <p>图片选择与预览器 &copy; 2023</p>
        </footer>
    </div>

    <script>
        // 获取DOM元素
        const fileInput = document.getElementById('file-input');
        const previewContainer = document.getElementById('preview-container');
        const previewPlaceholder = document.getElementById('preview-placeholder');
        const fileCount = document.getElementById('file-count');
        const countNumber = document.getElementById('count-number');
        
        // 存储已选择的图片
        let selectedImages = [];
        

        // SRC
        let selectedImageSrcList = [];
        

        // 处理文件选择
        fileInput.addEventListener('change', handleFiles);
        
        // 支持拖放功能
        const dropArea = document.querySelector('main');
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, highlight, false);
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, unhighlight, false);
        });
        
        function highlight() {
            dropArea.classList.add('border-primary', 'bg-blue-50');
        }
        
        function unhighlight() {
            dropArea.classList.remove('border-primary', 'bg-blue-50');
        }
        
        dropArea.addEventListener('drop', handleDrop, false);
        
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles({ target: { files } });
        }

        
        // 方式二：Object URL（性能更好，页面生命周期内使用）
        function filesToObjectURLs(files) {
            return files.map(file => URL.createObjectURL(file)); // string: "blob:..."
        }

        
        // 处理选择的文件
        async function handleFiles(e) {
            const files = e.target.files;
            
            if (!files.length) return;
            
            // 过滤非图片文件
            const imageFiles = Array.from(files).filter(file => file.type.startsWith('image/'));
            
            if (!imageFiles.length) {
                alert('请选择图片文件（JPG、PNG、GIF等）');
                return;
            }
            
            // 添加到已选图片数组
            selectedImages = [...selectedImages, ...imageFiles];

            
            // 选择一种：Data URL 或 Object URL
            const newSrcs = await filesToObjectURLs(selectedImages);        // 可复制到静态 HTML

            selectedImageSrcList = newSrcs;

            
            // 更新预览
            updatePreview();
            
            // 更新计数
            updateFileCount();
            
            // 重置input值，允许重复选择同一文件
            fileInput.value = '';
        }
        
        // 更新预览区域
        function updatePreview() {
            // 如果有图片，隐藏占位符，显示预览容器
            if (selectedImages.length > 0) {
                previewPlaceholder.classList.add('hidden');
                previewContainer.classList.remove('hidden');
            } else {
                previewPlaceholder.classList.remove('hidden');
                previewContainer.classList.add('hidden');
                return;
            }
            
            // 清空现有预览（除了正在动画的）
            previewContainer.innerHTML = '';
            
            // 为每个图片创建预览元素
            selectedImages.forEach((file, index) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const previewItem = document.createElement('div');
                    previewItem.className = 'relative group overflow-hidden rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-all duration-300 transform hover:-translate-y-1 bg-gray-50';
                    previewItem.dataset.index = index;
                    
                    // 添加淡入动画
                    previewItem.style.opacity = '0';
                    previewItem.style.transform = 'translateY(10px)';
                    
                    previewItem.innerHTML = `
                        <img src="${e.target.result}" alt="预览图" class="w-full h-40 object-cover" />
                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all duration-300 flex items-center justify-center opacity-0 group-hover:opacity-100">
                            <button class="delete-btn text-white bg-red-500 hover:bg-red-600 rounded-full w-8 h-8 flex items-center justify-center transition-all duration-300 transform scale-90 group-hover:scale-100">
                                <i class="fa fa-times"></i>
                            </button>
                        </div>
                        <div class="p-2 text-center text-xs text-gray-600 truncate">${file.name}</div>
                    `;
                    
                    previewContainer.appendChild(previewItem);
                    
                    // 触发动画
                    setTimeout(() => {
                        previewItem.style.opacity = '1';
                        previewItem.style.transform = 'translateY(0)';
                    }, 50 * index);
                    
                    // 删除按钮事件
                    previewItem.querySelector('.delete-btn').addEventListener('click', () => {
                        // 添加删除动画
                        previewItem.style.opacity = '0';
                        previewItem.style.transform = 'translateY(10px) scale(0.95)';
                        
                        setTimeout(() => {
                            // 从数组中移除
                            selectedImages.splice(index, 1);
                            // 更新预览
                            updatePreview();
                            // 更新计数
                            updateFileCount();
                        }, 300);
                    });
                };
                
                reader.readAsDataURL(file);
            });
        }
        
        // 更新文件计数显示
        function updateFileCount() {
            if (selectedImages.length > 0) {
                fileCount.classList.remove('hidden');
                countNumber.textContent = selectedImages.length;

                
                countNumber.innerText = '["' + selectedImageSrcList.join('",\r\n"') + '"]';

            } else {
                fileCount.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
